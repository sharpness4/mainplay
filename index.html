<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sinal Publico - Assista aos Melhores Canais ao Vivo Gratuitos</title>
    <meta name="description" content="Assista aos melhores canais ao vivo gratuitos no Sinal Publico. Desfrute de uma variedade de programação, incluindo notícias, esportes e entretenimento.">
    <meta name="keywords" content="Sinal Publico, canais ao vivo, transmissão ao vivo, TV online, esportes ao vivo">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=650bce971ce1b90012e5d869&product=sop' async='async'></script>
    <script src="https://kit.fontawesome.com/ccee9ace0a.js" crossorigin="anonymous"></script>  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
    <link rel="stylesheet" href="https://sinalpublico.netlify.app/css/styles.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <a class="navbar-brand" href="/">
            <img src="/imgs/iconpage.png" alt="Logo">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="https://sinalpublico.netlify.app/">https://sinalpublico.netlify.app/</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Carrossel de Notícias -->
    <div class="container">
        <h2 class="section-title">Últimas Notícias</h2>
        <div id="slider-news" class="owl-carousel owl-theme">
            <!-- As notícias serão injetadas aqui pelo JavaScript -->
        </div>
    </div>

    <section id="player-container" class="container">
        <div class="row justify-content-center">
            <div id="player" class="col-lg-8 col-md-12 p-0">
                <iframe id="videoPlayer" src="https://sinalpublico.netlify.app/play/dtv.html?id=globo" name="Player" allow="encrypted-media" allowfullscreen></iframe>
            </div>
        </div>
        <div class="row justify-content-center mt-4">
            <div class="col-lg-8 col-md-12 p-0">
                <section class="search-channel">
                    <input type="text" class="form-control" id="searchInput" placeholder="Pesquise o Canal...">
                </section>
                <section class="list-channels" id="channelList">
                    <!-- Carregando -->
                </section>
            </div>
        </div>
    </section>

    <div class="sharethis-inline-share-buttons"></div>
    <div class="widget-content">
        <a id="copyLink" href="https://t.me/sinalpublico" target="_top">
            <img border="0" data-original-height="100" data-original-width="100" src="https://sinalpublico.netlify.app/imgs/thumbgrupo.png" alt="GRUPO TELEGRAM">
        </a>
    </div>

    <div id="alert" class="alert">O Link foi Copiado!</div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        // Carregar canais
        fetch("https://sinalpublico.netlify.app/channels.json")
            .then(response => response.json())
            .then(channels => {
                const channelList = document.getElementById("channelList");

                channels.forEach(channel => {
                    const channelDiv = document.createElement("div");
                    channelDiv.className = "channel";
                    channelDiv.dataset.url = channel.url;
                    channelDiv.innerHTML = `
                        <img src="${channel.image}" alt="${channel.name}">
                        <div class="name">${channel.name}</div>
                    `;
                    channelList.appendChild(channelDiv);
                });

                document.querySelectorAll(".channel").forEach(function (channelElement) {
                    channelElement.addEventListener("click", function () {
                        const videoUrl = this.getAttribute("data-url");
                        document.getElementById("videoPlayer").setAttribute("src", videoUrl);
                    });
                });

                document.getElementById("searchInput").addEventListener("input", function () {
                    const searchQuery = this.value.toUpperCase();
                    document.querySelectorAll(".channel").forEach(function (channelElement) {
                        const channelName = channelElement.querySelector(".name").textContent.toUpperCase();
                        channelElement.style.display = channelName.includes(searchQuery) ? "flex" : "none";
                    });
                });
            })
            .catch(error => {
                console.error("Error loading channels:", error);
            });

        // Função para copiar o link
        document.getElementById("copyLink").addEventListener("click", function (event) {
            event.preventDefault();
            const link = this.href;
            navigator.clipboard.writeText(link)
                .then(function () {
                    const alertElement = document.getElementById("alert");
                    alertElement.style.display = "block";
                    setTimeout(() => {
                        alertElement.style.display = "none";
                    }, 2000);
                })
                .catch(function () {
                    console.error("Failed to copy the link.");
                });
        });

        // Função para buscar notícias com tentativas
        function fetchWithRetry(url, containerId, successCallback) {
            const maxRetries = 5; // Máximo de tentativas
            let attempts = 0;

            function fetchData() {
                fetch(url)
                    .then(response => {
                        if (!response.ok) throw new Error('Network response was not ok');
                        return response.text();
                    })
                    .then(data => {
                        successCallback(data);
                    })
                    .catch(error => {
                        attempts++;
                        if (attempts < maxRetries) {
                            console.warn(`Tentativa ${attempts} falhou, tentando novamente...`);
                            setTimeout(fetchData, 2000); // Aguardar 2 segundos antes de tentar novamente
                        } else {
                            document.getElementById(containerId).textContent = 'Erro ao carregar os dados: ' + error.message;
                        }
                    });
            }

            fetchData();
        }

        // Carregar as notícias
        const newsUrl = atob('aHR0cHM6Ly9jb3JzcHJveHkuaW8vP3VybD1odHRwczovL2dlLmdsb2JvLmNvbS9mdXRlYm9sLw==');
        fetchWithRetry(newsUrl, 'slider-news', (data) => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(data, 'text/html');
            const newsItems = doc.querySelectorAll('.bastian-feed-item');

            const sliderNewsContainer = document.getElementById('slider-news');
            sliderNewsContainer.innerHTML = '';

            if (newsItems.length === 0) {
                sliderNewsContainer.textContent = 'Nenhuma notícia encontrada.';
                return;
            }

            newsItems.forEach(item => {
                const title = item.querySelector('.feed-post-body-title a p')?.textContent || 'Título não disponível';
                const link = item.querySelector('.feed-post-body-title a')?.href || '#';
                const summary = item.querySelector('.feed-post-body-resumo p')?.textContent || 'Resumo não disponível';
                const imgSrc = item.querySelector('.feed-media-wrapper img')?.src || '';

                const newsHTML = `
                    <div class="item">
                        <a href="${link}">
                            <img src="${imgSrc}" alt="${title}">
                            <div class="overlay">
                                <h3>${title}</h3>
                                <span>${summary}</span>
                            </div>
                        </a>
                    </div>
                `;
                sliderNewsContainer.innerHTML += newsHTML;
            });

            // Inicializar Owl Carousel
            $('#slider-news').owlCarousel({
                items: 3,
                autoplay: true,
                loop: true,
                margin: 20,
                nav: false,
                dots: false,
                responsive: {
                    0: {
                        items: 1
                    },
                    600: {
                        items: 2
                    },
                    1000: {
                        items: 3
                    }
                }
            });
        });
    });
</script>

</body>
</html>
